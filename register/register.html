<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <title>Wake JIT Engine — Early Access</title>
  <meta name="description" content="Join the Wake Early Access waiting list to become an early developer. The download link will be released later to selected participants."/>

  <!-- Fonts + Tailwind (same as main page) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600&display=swap">

  <style>
    :root {
      --wake-blue: #0066CC;
    }
    body {
      font-family: 'Inter', sans-serif;
      background-color: #000000;
      color: #EAEAEA;
    }
    .mono { font-family: 'JetBrains Mono', monospace; }
    .wake-blue { color: var(--wake-blue); }
    .bg-wake-blue { background-color: var(--wake-blue); }
    .hover-bg-wake-blue:hover { background-color: #0055AA; }

    .title-outline {
      text-shadow:
        -2px -2px 0 #000,
         2px -2px 0 #000,
        -2px  2px 0 #000,
         2px  2px 0 #000;
    }

    /* Card look consistent with main page modules */
    .glass-card {
      background-color: rgba(0, 0, 0, 0.35);
      border: 1px solid var(--wake-blue);
      backdrop-filter: blur(6px);
      transition: all 0.25s ease;
    }
    .glass-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 18px rgba(0, 102, 204, 0.25);
      background-color: rgba(0, 0, 0, 0.45);
    }

    /* Console top strip (visual continuity, optional) */
    #console-strip {
      border-bottom: 1px solid #0b0b0b;
      background: linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.25));
    }

    .small-note { color: #9aa0a6; font-size: 0.85rem; }
    .muted     { color: #a9a9a9; }
    .input-dark {
      background-color: #0b0b0b;
      border: 1px solid #1f2937;
      color: #EAEAEA;
    }
    .input-dark:focus {
      outline: none;
      border-color: var(--wake-blue);
      box-shadow: 0 0 0 2px rgba(0,102,204,0.25);
    }
    .status {
      font-weight: 600; margin-top: .5rem;
    }
    .status.ok  { color: #25d366; }
    .status.err { color: #ff6b6b; }
    .hp { position: absolute; left: -5000px; opacity: 0; }
  </style>
</head>
<body class="min-h-screen">

  <!-- Visual continuity header -->
  <header id="console-strip" class="w-full">
    <div class="max-w-5xl mx-auto px-4 py-3 text-sm mono text-gray-300">
      &gt; Wake Runtime — Early Access Console
      <span class="text-gray-500"> // awaiting developer registrations…</span>
    </div>
  </header>

  <!-- Hero -->
  <section class="min-h-[30vh] flex flex-col justify-center items-center text-center px-4 py-14">
    <h1 class="mono text-4xl md:text-6xl font-bold mb-4">
      <span class="wake-blue title-outline">WAKE</span>
      <span class="title-outline">JIT ENGINE</span>
    </h1>
    <p class="text-lg md:text-xl max-w-2xl muted">
      The download link isn’t available yet. Join the waiting list to become an <span class="text-white font-semibold">early developer</span>
      and receive prioritized access when Early Access opens.
    </p>
  </section>

  <!-- Register Card -->
  <main class="px-4 pb-24">
    <div class="max-w-xl mx-auto glass-card rounded-xl p-6 md:p-8">
      <h2 class="mono text-2xl font-bold mb-2">Early Access — Waiting List</h2>
      <p class="muted mb-6">
        Enter your email to join. We’ll notify you when downloads roll out, along with insider updates.
      </p>

      <!-- Progressive enhancement:
           - No JS: classic urlencoded POST to the endpoint.
           - With JS: intercept + fetch JSON to the same endpoint. -->
      <form id="wakeForm" action="/subscribe" method="post" novalidate>
        <label for="email" class="block font-semibold mb-2">Email</label>
        <input id="email" name="email" type="email" autocomplete="email"
               placeholder="you@company.com" required
               class="input-dark w-full rounded-lg px-4 py-3 mb-4"/>

        <div class="flex items-start gap-3 mb-1">
          <input id="consent" name="consent" type="checkbox" required class="mt-[6px]">
          <label for="consent" class="font-normal text-sm muted">
            I agree to receive Early Access emails from Wake (one-click unsubscribe anytime).
          </label>
        </div>

        <!-- Honeypot anti-bot -->
        <div aria-hidden="true" class="hp">
          <label for="website">Your website</label>
          <input id="website" name="website" type="text" tabindex="-1" autocomplete="off"/>
        </div>

        <!-- Optional Turnstile can be injected later -->
        <div id="turnstile-box" class="mt-3"></div>

        <button id="submitBtn" type="submit"
                class="mt-5 inline-flex items-center justify-center bg-wake-blue hover-bg-wake-blue text-white font-semibold px-5 py-3 rounded-lg transition">
          Join the Waiting List
        </button>

        <div id="status" class="status" role="status" aria-live="polite"></div>

        <p class="small-note mt-3">
          You’re signing up for Early Access updates. The download link will be sent later to selected early developers.
        </p>

        <div class="border-t border-gray-800 mt-6 pt-6 small-note">
          You can unsubscribe anytime from any email. No spam, no trackers.
        </div>

        <noscript class="text-red-400 mt-2 block">
          JavaScript is disabled. The form will still submit, but you won't see inline status messages.
        </noscript>
      </form>
    </div>

    <!-- Footer -->
    <footer class="text-center mt-10">
      <p class="text-sm muted">
        © <span id="y"></span> Majify Technologies — Wake Early Access Program.
      </p>
    </footer>
  </main>

  <script>
  (function(){
    // ===== CONFIG =====
    // While your Worker is only on workers.dev:
    const ACTION_URL = "https://wake-ea.waketools-dev.workers.dev/subscribe";
    // After you add a Cloudflare Worker Route on your domain, switch to:
    // const ACTION_URL = "/subscribe";

    // Optional Turnstile site key (leave empty "" to hide widget here)
    const TURNSTILE_SITE_KEY = ""; // e.g. "0x4AAAAA...."

    // ===== INIT =====
    document.getElementById('y').textContent = new Date().getFullYear();
    const form = document.getElementById('wakeForm');
    const btn  = document.getElementById('submitBtn');
    const statusEl = document.getElementById('status');

    // Force the action to the Worker endpoint to avoid 404 on your own server
    form.action = ACTION_URL;

    // Optionally render Turnstile if you set a site key (not required)
    if (TURNSTILE_SITE_KEY) {
      const s = document.createElement('script');
      s.src = "https://challenges.cloudflare.com/turnstile/v0/api.js";
      s.async = true; s.defer = true;
      document.head.appendChild(s);

      const box = document.getElementById('turnstile-box');
      const div = document.createElement('div');
      div.className = 'cf-turnstile';
      div.setAttribute('data-sitekey', TURNSTILE_SITE_KEY);
      box.appendChild(div);
    }

    function setStatus(msg, ok){
      statusEl.textContent = msg || '';
      statusEl.className = 'status ' + (ok===true ? 'ok' : ok===false ? 'err' : '');
    }

    form.addEventListener('submit', async (e) => {
      // With JS, use fetch to keep the user on the page
      if (window.fetch) {
        e.preventDefault();
        setStatus('');

        if (!form.email.value || !form.email.checkValidity()) {
          setStatus('Enter a valid email.', false); return;
        }
        if (!form.consent.checked) {
          setStatus('Please accept Early Access emails to proceed.', false); return;
        }
        if (form.website.value) { // honeypot
          setStatus('Blocked (bot detected).', false); return;
        }

        btn.disabled = true;
        btn.textContent = 'Sending…';
        try {
          const payload = { email: form.email.value.trim(), consent: true };
          const tsField = form.querySelector('input[name="cf-turnstile-response"]');
          if (tsField && tsField.value) payload["cf-turnstile-response"] = tsField.value;

          const res = await fetch(form.action, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          let ok = res.ok;
          // New message: clarify that download won’t be immediate.
          let msg = 'You’re on the waiting list. We’ll email you when Early Access downloads open.';
          let directUrl = '';

          const ct = res.headers.get('content-type') || '';
          if (ct.includes('application/json')) {
            const data = await res.json().catch(()=>({}));
            ok = ('ok' in data) ? !!data.ok : res.ok;
            msg = (data.message || msg);
            directUrl = data.directUrl || '';
          } else {
            const txt = await res.text();
            if (txt) msg = txt;
          }

          if (ok) {
            setStatus(msg, true);
            // If backend still decides to return a direct link later, we keep support:
            if (directUrl) {
              statusEl.innerHTML = `Download ready: <a class="underline text-white" href="${directUrl}">click here</a>.`;
              statusEl.className = 'status ok';
            }
            form.reset();
          } else {
            setStatus(msg || 'Error. Please try again in a moment.', false);
          }
        } catch(err){
          setStatus('Network error. Please try again.', false);
        } finally {
          btn.disabled = false;
          btn.textContent = 'Join the Waiting List';
        }
      }
      // Without JS, the browser will do a classic urlencoded POST to ACTION_URL
    });
  })();
  </script>
</body>
</html>
